<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Data</title>
    <!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    
</head>
<body class="bg-light">

<div class="container py-4">
    <h2 class="mb-4 text-primary">Purchases</h2>

    <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle text-center shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Date</th>
                    <th>Status</th>
                    <th>description</th>
                    <th>Supplier</th>
                    <th>Total</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr>
                	<td>{{ row.purchase_date }}</td>
                    <td>{{ "Complete" if row.status else "Incomplete" }}</td>
   <td><textarea   id="description_{{ row.purchase_id}}"  class="form-control text-center  d-inline-block" rows="1"  style="width:auto;min-width:120px;max-width:150px;" onchange="updatePurchase('{{row.purchase_id}}','description',this.value)">{{ row.description }}</textarea></td>
                    <td>{{ row.supplier_id }}</td>
                    <td>{{ row.total_amount }}</td>
                    <td class="sticky-col">
                        <div class="d-flex flex-wrap gap-2 justify-content-center">
                            {% if not row.status %}
                            <a href="/purchase/{{ row.purchase_id }}/complete" target="_blank" class="btn btn-sm btn-warning">Complete</a>
                            {% endif %}
                            <a href="/purchase/{{ row.purchase_id }}/additems" target="_blank" class="btn btn-sm btn-success">Add</a>
                            <a href="/purchase/{{ row.purchase_id }}/viewitems" target="_blank" class="btn btn-sm btn-info">View</a>

                            <a href="/purchase/{{ row.purchase_id }}/remove" target="_blank" class="btn btn-sm btn-danger">Rm</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Debug Console -->
<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>
  eruda.init();
  console.log("Hello Android!");
</script>
<style>
.table-responsive {
  overflow-x: auto;
  position: relative;
}

/* Sticky column fix */
.sticky-col {
  position: sticky;
  right: 0;
  background: #fff; /* match light table rows */
  z-index: 3;
  white-space: nowrap; /* keep buttons inline */
}

/* make header sticky col match dark bg */
thead .sticky-col {
  background: #212529; /* Bootstrap dark */
  color: #fff;
}
</style>
<script>
  function updatePurchase(purchase_id,casek,val){
          
        fetch("/purchase/update", {
             method: "POST",
             headers: { "Content-Type": "application/json" },
             body: JSON.stringify({ 
               purchase_id:purchase_id,
               
               new_value:val,
               target:casek             
            })
      })
      .then(r => r.json())
      .then(data => {
      	console.log(casek);
      if (casek=="description"){
      idq="description_"+purchase_id;
      element=document.getElementById(idq);
      element.style.height = "auto";     
    // reset
  element.style.height = element.scrollHeight + "px"; // adjust to fit
  }
       });

   }

</script>
<script src="{{ url_for('static', filename='js/product_list.js') }}"></script>
</body>
</html>