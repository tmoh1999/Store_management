<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container my-5 p-4 bg-white rounded shadow">
    <!-- Top controls -->
    <div class="mb-3 d-flex align-items-center gap-2 justify-content-center">
    <label for="date_input" class="form-label mb-0 fw-bold text-secondary">Choose Date:</label>
    <input id="date_input" type="date" 
           class="form-control border-primary text-center fw-semibold" 
           style="max-width: 200px; background-color: #f8f9fa;" 
           onchange="updatelist2(this.value)">
</div>
        
        <select class="form-select w-auto" id="sales_filter" onchange="updatelist()">
            <option>ALL</option>
            <option>Today</option>
        </select>
    </div>

    <!-- Table responsive wrapper -->
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle" id="sales_table">
            <thead class="table-primary text-center">
                <!-- Totals row -->
                <tr>
                    <th scope="col">
                        <input id="start_money" type="number" class="form-control" placeholder="Start" onchange="updatetotal(this.value)" style="min-width: 60px;">
                    </th>
                    <th scope="col"></th>
                    <th scope="col" id="total_quantity"></th>
                    <th scope="col" id="total_price"></th>
                    <th scope="col" id="remain"></th>
                    <th scope="col" style="position: sticky; right: 0; background: #007bff; color:white;">Actions</th>
                </tr>
                <!-- Column headers -->
                <tr>
                    <th scope="col">SaleID</th>
                    <th scope="col">Date</th>
                    <th scope="col">N. Products</th>
                    <th scope="col">Total Price</th>
                    <th scope="col"></th>
                    <th scope="col" style="position: sticky; right: 0; background: #007bff; color:white;">Actions</th>
                </tr>
            </thead>
            <tbody class="text-center">
                {% for row in data %}
                <tr>
                    <td>{{ row["sale_id"] }}</td>
                    <td>{{ row["date"] }}</td>
                    <td>{{ row["quantity"] }}</td>
                    <td>{{ row["total_amount"] }}</td>
                    <td></td>
                    <td class="d-flex flex-column justify-content-center gap-2 h-100" style="position: sticky; right: 0; ">
                        <button class="btn btn-success btn-sm w-100" onclick="window.open('/sales/{{ row["sale_id"] }}/viewsaleitems', '_blank', 'width=600,height=400')">View</button>
                        <button class="btn btn-danger btn-sm w-100" onclick="removeSale({{ row["sale_id"] }})">Remove</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    let data = {{ data|tojson }};
    let xtot = 0, xtot2 = 0;
    data.forEach(row => {
        xtot += row.total_amount;
        xtot2 += row.quantity;
    });
    document.getElementById("total_price").innerHTML = xtot;
    document.getElementById("total_quantity").innerHTML = parseFloat(xtot2).toFixed(2);

    document.getElementById('date_input').value = new Date().toISOString().split('T')[0];
</script>
<!-- Debug tool for Termux -->
<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>
  eruda.init();
  console.log("Hello Android!");
</script>
<script src="{{ url_for('static', filename='js/sales_list.js') }}"></script>
</body>
</html>